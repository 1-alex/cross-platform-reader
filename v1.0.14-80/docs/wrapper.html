<!DOCTYPE html>

<html>
<head>
  <title>wrapper.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="book.html">
                book.js
              </a>
            
              
              <a class="source" href="bookdata.html">
                bookdata.js
              </a>
            
              
              <a class="source" href="cfi.html">
                cfi.js
              </a>
            
              
              <a class="source" href="config.html">
                config.js
              </a>
            
              
              <a class="source" href="display.html">
                display.js
              </a>
            
              
              <a class="source" href="epub.html">
                epub.js
              </a>
            
              
              <a class="source" href="events.html">
                events.js
              </a>
            
              
              <a class="source" href="filters.html">
                filters.js
              </a>
            
              
              <a class="source" href="formatting.html">
                formatting.js
              </a>
            
              
              <a class="source" href="layout.html">
                layout.js
              </a>
            
              
              <a class="source" href="navigation.html">
                navigation.js
              </a>
            
              
              <a class="source" href="parse.html">
                parse.js
              </a>
            
              
              <a class="source" href="styles.html">
                styles.js
              </a>
            
              
              <a class="source" href="touch.html">
                touch.js
              </a>
            
              
              <a class="source" href="wrapper.html">
                wrapper.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>wrapper.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">'use strict'</span>;
<span class="hljs-comment">/* exported READER */</span>
<span class="hljs-comment">/* globals $, Reader */</span>
<span class="hljs-keyword">var</span> READER = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Public methods from the Reader.
All client communication is done here and only here. Do NOT send any events from other files.
The reader should return a promise for any action, a promise that gets resolved/rejected and the appropriate event is fired when the promise is fulfiled.
The goal is to make the reader as client-ignorant as possible.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
	<span class="hljs-keyword">var</span> _isLoading = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Generates an object summarizing the reader status.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendStatus</span><span class="hljs-params">(call)</span> </span>{
		Reader.Notify.event($.extend({}, Reader.Event.getStatus(call)));
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Wrap a reader action so that it will return the reader status after the action is performed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">statusWrap</span><span class="hljs-params">(obj, method)</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
			<span class="hljs-keyword">var</span> result = obj[method].apply(obj, <span class="hljs-built_in">arguments</span>);
			sendStatus(method);
			<span class="hljs-keyword">return</span> result;
		};
	}</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>Wrap a reader action so that it will send loading notifications if applicable:</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadingWrap</span><span class="hljs-params">(obj, method)</span> </span>{
		<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
			<span class="hljs-keyword">if</span> (_isLoading) {
				<span class="hljs-keyword">return</span> $.Deferred().reject(Reader.Event.LOADING_STARTED).promise();
			}
			<span class="hljs-keyword">return</span> obj[method].apply(obj, <span class="hljs-built_in">arguments</span>).always(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">complete</span><span class="hljs-params">()</span> </span>{
				<span class="hljs-keyword">if</span> (_isLoading) {
					Reader.Notify.event(Reader.Event.LOADING_COMPLETE);
					_isLoading = <span class="hljs-literal">false</span>;
				}
			}).then(
				<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">done</span><span class="hljs-params">()</span> </span>{
					sendStatus(method);
				},
				<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fail</span><span class="hljs-params">(err)</span> </span>{
					<span class="hljs-keyword">if</span> (err === Reader.Event.END_OF_BOOK || err === Reader.Event.START_OF_BOOK) {
						Reader.Notify.event(err);
					} <span class="hljs-keyword">else</span> {
						Reader.Notify.error(err);
					}
				},
				<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">progress</span><span class="hljs-params">(args)</span> </span>{
					<span class="hljs-keyword">if</span> (!_isLoading &amp;&amp; args &amp;&amp; (args.type === <span class="hljs-string">'chapter.loading'</span> || args.type === <span class="hljs-string">'meta.loading'</span>)) {
						Reader.Notify.event(Reader.Event.LOADING_STARTED);
						_isLoading = <span class="hljs-literal">true</span>;
					}
				}
			);
		};
	}

	<span class="hljs-keyword">return</span> {
		init: loadingWrap(Reader, <span class="hljs-string">'init'</span>),
		setLineHeight: statusWrap(Reader, <span class="hljs-string">'setLineHeight'</span>),
		increaseLineHeight: statusWrap(Reader, <span class="hljs-string">'increaseLineHeight'</span>),
		decreaseLineHeight: statusWrap(Reader, <span class="hljs-string">'decreaseLineHeight'</span>),
		increaseFontSize: statusWrap(Reader, <span class="hljs-string">'increaseFontSize'</span>),
		decreaseFontSize: statusWrap(Reader, <span class="hljs-string">'decreaseFontSize'</span>),
		setFontSize: statusWrap(Reader, <span class="hljs-string">'setFontSize'</span>),
		setTextAlign: statusWrap(Reader, <span class="hljs-string">'setTextAlign'</span>),
		setMargin: statusWrap(Reader, <span class="hljs-string">'setMargin'</span>),
		setTheme: statusWrap(Reader, <span class="hljs-string">'setTheme'</span>),
		setFontFamily: statusWrap(Reader, <span class="hljs-string">'setFontFamily'</span>),
		setPreferences: statusWrap(Reader, <span class="hljs-string">'setPreferences'</span>),
		getCFI: Reader.CFI.getCFI,
		goToCFI: loadingWrap(Reader.CFI, <span class="hljs-string">'goToCFI'</span>),
		goToProgress: loadingWrap(Reader.Navigation, <span class="hljs-string">'goToProgress'</span>),
		next: loadingWrap(Reader.Navigation, <span class="hljs-string">'next'</span>),
		prev: loadingWrap(Reader.Navigation, <span class="hljs-string">'prev'</span>),
		loadChapter: loadingWrap(Reader.Navigation, <span class="hljs-string">'loadChapter'</span>),
		getProgress: Reader.Navigation.getProgress,
		getBookmarks: Reader.Bookmarks.getBookmarks,
		setBookmarks: statusWrap(Reader.Bookmarks, <span class="hljs-string">'setBookmarks'</span>),
		setBookmark: statusWrap(Reader.Bookmarks, <span class="hljs-string">'setBookmark'</span>),
		goToBookmark: loadingWrap(Reader.Bookmarks, <span class="hljs-string">'goToBookmark'</span>),
		removeBookmark: statusWrap(Reader.Bookmarks, <span class="hljs-string">'removeBookmark'</span>),
		setHighlight: statusWrap(Reader.Highlights, <span class="hljs-string">'setHighlight'</span>),
		setHighlights: statusWrap(Reader.Highlights, <span class="hljs-string">'setHighlights'</span>),
		removeHighlight: statusWrap(Reader.Highlights, <span class="hljs-string">'removeHighlight'</span>),
		showHeaderAndFooter: Reader.showHeaderAndFooter,
		hideHeaderAndFooter: Reader.hideHeaderAndFooter,
		resizeContainer: statusWrap(Reader.Layout, <span class="hljs-string">'resizeContainer'</span>),
		Event: Reader.Event,
		refreshLayout: statusWrap(Reader, <span class="hljs-string">'refreshLayout'</span>),
		enableDebug: Reader.Debug.enable,
		disableDebug: Reader.Debug.disable
	};
}());</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
