<!DOCTYPE html>

<html>
<head>
  <title>wrapper.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="bookdata.html">
                bookdata.js
              </a>
            
              
              <a class="source" href="cfi.html">
                cfi.js
              </a>
            
              
              <a class="source" href="config.html">
                config.js
              </a>
            
              
              <a class="source" href="display.html">
                display.js
              </a>
            
              
              <a class="source" href="events.html">
                events.js
              </a>
            
              
              <a class="source" href="filters.html">
                filters.js
              </a>
            
              
              <a class="source" href="formatting.html">
                formatting.js
              </a>
            
              
              <a class="source" href="layout.html">
                layout.js
              </a>
            
              
              <a class="source" href="navigation.html">
                navigation.js
              </a>
            
              
              <a class="source" href="parse.html">
                parse.js
              </a>
            
              
              <a class="source" href="styles.html">
                styles.js
              </a>
            
              
              <a class="source" href="wrapper.html">
                wrapper.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>wrapper.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-pi">'use strict'</span>;
<span class="hljs-comment">/* exported READER */</span>
<span class="hljs-comment">/* globals $, Reader */</span>
<span class="hljs-keyword">var</span> READER = (<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Public methods from the Reader.
All client communication is done here and only here. Do NOT send any events from other files.
The reader should return a promise for any action, a promise that gets resolved/rejected and the appropriate event is fired when the promise is fulfiled.
The goal is to make the reader as client-ignorant as possible.</p>

            </div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Generates an object summarizing the reader status.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> _send_status = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(call)</span>{</span>
		Reader.Notify.event($.extend({}, Reader.Event.getStatus(), {
			<span class="hljs-string">'call'</span>: call || <span class="hljs-string">''</span>
		}));
	};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Wrap a reader action so that it will return the reader status after the action is performed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>	<span class="hljs-keyword">var</span> _status_wrap = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(action, call)</span>{</span>
		<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{</span>
			<span class="hljs-keyword">var</span> result = action.apply(<span class="hljs-literal">null</span>, <span class="hljs-built_in">arguments</span>);
			_send_status(call);
			<span class="hljs-keyword">return</span> result;
		};
	};

	<span class="hljs-keyword">return</span> {
		init: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">init</span><span class="hljs-params">()</span>{</span>
			<span class="hljs-keyword">return</span> Reader.init.apply(Reader, <span class="hljs-built_in">arguments</span>).always(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initComplete</span><span class="hljs-params">()</span>{</span>
				Reader.Notify.event(Reader.Event.LOADING_COMPLETE);
			}).then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initSuccess</span><span class="hljs-params">()</span>{</span>
					_send_status(<span class="hljs-string">'init'</span>);
				}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initFailure</span><span class="hljs-params">(err)</span>{</span>
					Reader.Notify.error(err);
				}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initNotify</span><span class="hljs-params">()</span>{</span>
					Reader.Notify.event(Reader.Event.LOADING_STARTED);
				}
			);
		},
		setLineHeight: _status_wrap(Reader.setLineHeight, <span class="hljs-string">'setLineHeight'</span>),
		increaseLineHeight: _status_wrap(Reader.increaseLineHeight, <span class="hljs-string">'increaseLineHeight'</span>),
		decreaseLineHeight: _status_wrap(Reader.decreaseLineHeight, <span class="hljs-string">'decreaseLineHeight'</span>),
		increaseFontSize: _status_wrap(Reader.increaseFontSize, <span class="hljs-string">'increaseFontSize'</span>),
		decreaseFontSize: _status_wrap(Reader.decreaseFontSize, <span class="hljs-string">'decreaseFontSize'</span>),
		setFontSize: _status_wrap(Reader.setFontSize, <span class="hljs-string">'setFontSize'</span>),
		setTextAlign: _status_wrap(Reader.setTextAlign, <span class="hljs-string">'setTextAlign'</span>),
		setMargin: _status_wrap(Reader.setMargin, <span class="hljs-string">'setMargin'</span>),
		setTheme: _status_wrap(Reader.setTheme, <span class="hljs-string">'setTheme'</span>),
		setFontFamily: _status_wrap(Reader.setFontFamily, <span class="hljs-string">'setFontFamily'</span>),
		setPreferences: _status_wrap(Reader.setPreferences, <span class="hljs-string">'setPreferences'</span>),
		getCFI: Reader.CFI.getCFI,
		goToCFI: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goToCFI</span><span class="hljs-params">()</span>{</span>
			Reader.Notify.event(Reader.Event.LOADING_STARTED);
			<span class="hljs-keyword">return</span> Reader.CFI.goToCFI.apply(Reader.CFI, <span class="hljs-built_in">arguments</span>).always(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goToCFIComplete</span><span class="hljs-params">()</span>{</span>
				Reader.Notify.event(Reader.Event.LOADING_COMPLETE);
				_send_status(<span class="hljs-string">'goToCFI'</span>);
			});
		},
		next: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span><span class="hljs-params">()</span>{</span>
			<span class="hljs-keyword">var</span> _loading_required = <span class="hljs-literal">false</span>;
			<span class="hljs-keyword">return</span> Reader.Navigation.next().always(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nextComplete</span><span class="hljs-params">()</span>{</span>
				<span class="hljs-keyword">if</span>(_loading_required){
					Reader.Notify.event(Reader.Event.LOADING_COMPLETE);
				}
			}).then(
				<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nextOnSuccess</span><span class="hljs-params">()</span>{</span>
					_send_status(<span class="hljs-string">'next'</span>);
				}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nextOnError</span><span class="hljs-params">(err)</span>{</span>
					<span class="hljs-keyword">if</span>(err === Reader.Event.END_OF_BOOK || err === Reader.Event.START_OF_BOOK){
						Reader.Notify.event(err);
					} <span class="hljs-keyword">else</span> {
						Reader.Notify.error(err);
					}
				}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nextOnNotification</span><span class="hljs-params">(args)</span>{</span>
					<span class="hljs-keyword">if</span> (args &amp;&amp; args.type === <span class="hljs-string">'load.img'</span>) {
						<span class="hljs-keyword">return</span>;
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>book requires remote file, send a loading event to notify the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					Reader.Notify.event(Reader.Event.LOADING_STARTED);
					_loading_required = <span class="hljs-literal">true</span>;
				}
			);
		},
		prev: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">next</span><span class="hljs-params">()</span>{</span>
			<span class="hljs-keyword">var</span> _loading_required = <span class="hljs-literal">false</span>;
			<span class="hljs-keyword">return</span> Reader.Navigation.prev().always(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prevComplete</span><span class="hljs-params">()</span>{</span>
				<span class="hljs-keyword">if</span>(_loading_required){
					Reader.Notify.event(Reader.Event.LOADING_COMPLETE);
				}
			}).then(
				<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prevOnSuccess</span><span class="hljs-params">()</span>{</span>
					_send_status(<span class="hljs-string">'prev'</span>);
				}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prevOnError</span><span class="hljs-params">(err)</span>{</span>
					<span class="hljs-keyword">if</span>(err === Reader.Event.END_OF_BOOK || err === Reader.Event.START_OF_BOOK){
						Reader.Notify.event(err);
					} <span class="hljs-keyword">else</span> {
						Reader.Notify.error(err);
					}
				}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prevOnNotification</span><span class="hljs-params">(args)</span>{</span>
					<span class="hljs-keyword">if</span> (args &amp;&amp; args.type === <span class="hljs-string">'load.img'</span>) {
						<span class="hljs-keyword">return</span>;
					}</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>book requires remote file, send a loading event to notify the client</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>					Reader.Notify.event(Reader.Event.LOADING_STARTED);
					_loading_required = <span class="hljs-literal">true</span>;
				}
			);
		},
		loadChapter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadChapter</span><span class="hljs-params">()</span>{</span>
			Reader.Notify.event(Reader.Event.LOADING_STARTED);
			<span class="hljs-keyword">return</span> Reader.Navigation.loadChapter.apply(Reader.Navigation, <span class="hljs-built_in">arguments</span>).always(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadChapterComplete</span><span class="hljs-params">()</span>{</span>
				Reader.Notify.event(Reader.Event.LOADING_COMPLETE);
			}).then(
				<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadChapterSuccess</span><span class="hljs-params">()</span>{</span>
					_send_status(<span class="hljs-string">'loadChapter'</span>);
				}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadChapterFail</span><span class="hljs-params">(err)</span>{</span>
					Reader.Notify.error(err);
				}
			);
		},
		getProgress: Reader.Navigation.getProgress,
		getTOC: Reader.getTOC,
		getSPINE: Reader.getSPINE,
		getBookmarks: Reader.Bookmarks.getBookmarks,
		setBookmarks: _status_wrap(Reader.Bookmarks.setBookmarks, <span class="hljs-string">'setBookmarks'</span>),
		setBookmark: _status_wrap(Reader.Bookmarks.setBookmark, <span class="hljs-string">'setBookmark'</span>),
		goToBookmark: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goToBookmark</span><span class="hljs-params">()</span>{</span>
			Reader.Notify.event(Reader.Event.LOADING_STARTED);
			<span class="hljs-keyword">return</span> Reader.Bookmarks.goToBookmark.apply(Reader.Bookmarks, <span class="hljs-built_in">arguments</span>).always(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goToCFIComplete</span><span class="hljs-params">()</span>{</span>
				Reader.Notify.event(Reader.Event.LOADING_COMPLETE);
			}).then(
				<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goToBookmarkSuccess</span><span class="hljs-params">()</span>{</span>
					_send_status(<span class="hljs-string">'goToBookmark'</span>);
				}, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">goToBookmarkFail</span><span class="hljs-params">(err)</span>{</span>
					Reader.Notify.error(err);
				}
			);
		},
		removeBookmark: _status_wrap(Reader.Bookmarks.removeBookmark, <span class="hljs-string">'removeBookmark'</span>),
		showHeaderAndFooter: Reader.showHeaderAndFooter,
		hideHeaderAndFooter: Reader.hideHeaderAndFooter,
		resizeContainer: _status_wrap(Reader.resizeContainer, <span class="hljs-string">'resizeContainer'</span>),
		Event: Reader.Event,
		refreshLayout: _status_wrap(Reader.refreshLayout, <span class="hljs-string">'refreshLayout'</span>),
		enableDebug: Reader.Debug.enable,
		disableDebug: Reader.Debug.disable
	};
}());</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
