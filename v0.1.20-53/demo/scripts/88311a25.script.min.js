"use strict";angular.module("app",["ngRoute"]).config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode(!1).hashPrefix("!"),a.when("/",{templateUrl:"views/main.html",controller:"Reader_controller"}).when("/:isbn",{templateUrl:"views/main.html",controller:"Reader_controller"}).otherwise({redirectTo:"/"})}]).controller("Reader_controller",["$scope","$routeParams","$exceptionHandler","Book",function(a,b,c,d){function e(a){$("#log .panel-body").prepend("<p>"+JSON.stringify(a)+"</p>")}a.book={isbn:b.isbn||"",url:""},a.environment={options:[{label:"QA",url:"https://qa.mobcastdev.com/api/service/catalogue/books/"},{label:"Prod",url:"https://api.blinkboxbooks.com/service/catalogue/books/"},{label:"Local",url:"/books/"}],current:null},a.layout={width:600,height:800,columns:1,padding:0},a.preferences={margin:"medium",textAlign:"left",fontFamily:"Helvetica",theme:"light",lineHeight:1.2,fontSize:1},a.formSettings={lineHeight:{min:1.1,max:20,step:.01},fontSize:{min:.5,max:15,step:.1},fonts:["Helvetica","Times new Roman","Courier New","Arial"],alignment:["left","justify"],margins:["min","medium","max"],themes:["light","transparent","dark","sepia"]},a.handlers={prev:function(){READER.prev()},next:function(){READER.next()},cfi:function(){try{e(decodeURIComponent(READER.getCFI()))}catch(a){e(a)}}},a.$watch("environment.current.url + book.isbn",function(b){a.book.isbn&&d.get(b).then(function(b){a.book.url=b},function(a){c({message:a.status,stack:a.config},a)})});var f=!1;a.$watch("book.url",function(b){b&&(READER.init({container:"#reader_container",width:a.layout.width,height:a.layout.height,padding:a.layout.padding,columns:a.layout.columns,url:b,bookmarks:[],listener:e,preferences:a.preferences}),f||(a.$watch("preferences",READER.setPreferences,!0),a.$watch("layout",READER.resizeContainer,!0),f=!0))})}]).factory("Book",["$http","$q",function(a,b){return{get:function(c){var d=b.defer();return a({url:c,method:"GET"}).then(function(a){if(a.data.links&&a.data.links.length>0){var b,c;for(b=0,c=a.data.links.length;b!==c;b+=1){var e=a.data.links[b];if("Sample"===e.title&&""!==e.href){var f=document.createElement("a");f.href=e.href;var g=0===f.pathname.indexOf("/")?f.pathname:"/"+f.pathname;d.resolve("//"+f.hostname+"/params;v=0"+g)}}}else d.reject(a)},d.reject),d.promise}}}]);