"use strict";var app=angular.module("app",[]);app.controller("Reader_controller",["$scope","$exceptionHandler","Book",function(a,b,c){function d(a){$("#log .panel-body").prepend("<p>"+JSON.stringify(a)+"</p>")}var e="https://api.blinkboxbooks.com/service/catalogue/books/";a.book={isbn:"",url:""},a.layout={width:600,height:800,columns:1,padding:0},a.preferences={margin:"medium",textAlign:"left",fontFamily:"Helvetica",theme:"light",lineHeight:1.2,fontSize:1},a.formSettings={lineHeight:{min:1.1,max:20,step:.01},fontSize:{min:.5,max:15,step:.1},fonts:["Helvetica","Times new Roman","Courier New","Arial"],alignment:["left","justify"],margins:["min","medium","max"],themes:["light","transparent","dark","sepia"]},a.handlers={prev:function(){READER.prev()},next:function(){READER.next()},cfi:function(){try{d(decodeURIComponent(READER.getCFI()))}catch(a){d(a)}}},a.$watch("book.isbn",function(d){d&&c.get(e+d).then(function(b){a.book.url=b},function(a){b({message:a.status,stack:a.config},a)})});var f=!1;a.$watch("book.url",function(b){b&&(READER.init({container:"#reader_container",width:a.layout.width,height:a.layout.height,padding:a.layout.padding,columns:a.layout.columns,url:b,bookmarks:[],listener:d,preferences:a.preferences}),f||(console.log("Watching"),a.$watch("preferences",READER.setPreferences,!0),a.$watch("layout",READER.resizeContainer,!0),f=!0))})}]),app.factory("Book",["$http",function(a){return{get:function(b){var c={url:b,method:"GET"};return a(c).then(function(a){if(a.data.links&&a.data.links.length>0){var b,c;for(b=0,c=a.data.links.length;b!==c;b+=1){var d=a.data.links[b];if("Sample"===d.title&&""!==d.href){var e=document.createElement("a");e.href=d.href;var f=0===e.pathname.indexOf("/")?e.pathname:"/"+e.pathname;return"//"+e.hostname+"/params;v=0"+f}}}})}}}]);